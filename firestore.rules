rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Usuários
    match /usuarios/{matricula} {
      allow read, write: if request.auth != null 
        && (request.auth.token.email.matches('^' + matricula + '@movebuss.local$')
            || request.auth.token.email.matches('^(4144|70029|6266)@movebuss.local$'));
    }

    // Caixas e Relatórios
    match /relatorios/{data} {
      allow read, write: if request.auth != null 
        && (request.auth.token.email.matches('^(4144|70029|6266)@movebuss.local$')
            || request.auth.token.email.split('@')[0] in resource.data.matriculasPermitidas);
    }
  }
}